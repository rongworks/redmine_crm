<h2> <%= "CRM" %><%= " : #{@project.name}" if @project.present? %> </h2>
<div id="companies_index" ng-app="contacts" ng-controller="CompaniesController as companiesCtrl">


  <div class="pure-g">

    <div class="pure-u-1-1">
      <i class="fa fa-search"></i>
      <input type="text" placeholder="Schnellsuche" ng-model="companiesCtrl.searchInput" ng-model-options="{ debounce: 1000 }">

      <p>{{filtered.length}} / {{companiesCtrl.companies.length}}</p>
    </div>
    <!-- companies -->
    <div class="pure-u-3-4">
      <div class="pure-g company_header">
        <div class="pure-u-2-24">
          <input type="checkbox" class="align-right"
                 ng-checked="companiesCtrl.selectedCompanies.length > 0"
                 ng-click="companiesCtrl.toggleSelectionAll(filtered);"><br/>
        </div>
        <p class="pure-u-8-24"><%= Company.model_name.human %></p>
        <p class="pure-u-5-24"><%= Client.model_name.human %></p>
        <p class="pure-u-5-24"><%= t("tags") %></p>
        <p class="pure-u-4-24"><%= CrmAction.model_name.human(count:2) %></p>
      </div>
      <div class="company_item pure-g" ng-repeat="company in filtered = (companiesCtrl.companies | filter: companiesCtrl.searchInput)">

        <div class="pure-u-2-24">
          <input type="checkbox" class="align-right"
                 ng-checked="companiesCtrl.selectedCompanies.indexOf(company) > -1"
                 ng-click="companiesCtrl.setSelected(company,false)"><br/>

          <a ng-href="/companies/{{company.id}}" title="Anzeigen" class="pure-button button-symbolic">
            <i class="fa fa-eye"></i>
          </a>
          <a ng-href="/companies/{{company.id}}/edit" title="Editieren" class="pure-button button-symbolic">
            <i class="fa fa-pencil-square-o"></i>
          </a>
          <a title="Zu Aktion hinzufügen" class="pure-button button-symbolic" ng-click="companiesCtrl.setSelected(company,true); companiesCtrl.showActionModal = true;">
            <i class="fa fa-fax"></i>
          </a>
          <a ng-href="/clients/new?company_id={{company.id}}" title="Kontakt hinzufügen" class="pure-button button-symbolic">
            <i class="fa fa-user-plus"></i>
          </a>
        </div>
        <div class="company_item_cell pure-u-8-24">
          <span class="company_name">{{company.name}}</span>

          <p><strong>{{company.branch}}</strong> <a href="{{company.url}}">Homepage</a></p>

          <p>{{company.zip_code+', '+company.province+', '+company.street}}</p>
        </div>
        <div class="company_item_cell pure-u-5-24">
          <br/>

          <p ng-show="company.primary_contact == null"> Kein primärer Kontakt </p>
          <a ng-href="/clients/{{company.primary_contact.id}}" class="company_name">{{company.primary_contact.first_name+"
            "+company.primary_contact.last_name}}</a>

          <p>{{company.primary_contact.department}}</p>
          <a ng-href="mailto:{{company.primary_contact.email}}">{{company.primary_contact.email}}</a>
        </div>
        <div class="company_item_cell pure-u-5-24">
      <span ng-repeat="tag in company.tags">
        <a ng-href="" class="tags" ng-click="companiesCtrl.searchInput = tag.name">{{tag.name}}</a>
      </span>
        </div>
        <div class="pure-u-4-24">
          Aktionen:
          <ul>
            <li ng-repeat="crm_action in company.crm_actions">
              {{crm_action.name}}
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- sidebar -->
    <div id="companies_sidebar" class="pure-u-1-4">
      <div id="companies_options">
        <p>{{companiesCtrl.selectedCompanies.length}} Unternehmen ausgewählt</p>
        <button title="Als CSV herunterladen" class="pure-button button-symbolic">
          <i class="fa fa-file-excel-o"></i>
        </button>
        <br/>

        <button title="Zu Aktionen hinzufügen" class="pure-button button-symbolic" ng-click="companiesCtrl.showActionModal = true;">
          <i class="fa fa-fax"></i>
        </button>
      </div>
    </div>
  </div>
  <div id="add-company-to-actions" ng-class="{hidden: companiesCtrl.showActionModal == false}" ng-controller="CrmActionsController as actCtrl">
    <i class="fa fa-search"></i>
    <input type="text" placeholder="Aktion suchen" ng-model="actCtrl.searchInput" ng-model-options="{ debounce: 100 }">
    <ul>
      <li ng-repeat="action in actCtrl.crmActions | filter: actCtrl.searchInput">
        <input type="checkbox" ng-click="actCtrl.setSelected(action)"><label>{{action.name}}</label>
      </li>
    </ul>
    <p class="clear-fix"></p>
    <hr>
    <button class="pure-button button-symbolic" ng-click="companiesCtrl.addActions(actCtrl.selectedActions);companiesCtrl.showActionModal = false;">
      <i class="fa fa-check"></i>
      Hinzufügen
    </button>
    <button class="pure-button button-symbolic" ng-click="companiesCtrl.showActionModal = false;">
      <i class="fa fa-times"></i>
      Abbrechen
    </button>
  </div>
</div>
